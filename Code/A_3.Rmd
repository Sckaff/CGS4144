---
title: "A_3"
output: html_document
date: "2022-10-24"
---

Import libraries
```{r}
library(DESeq2)
library(rstudioapi)
library(dplyr)
library(tidyverse)

set.seed(12345)
```

Read important datasets from Assignment 2
```{r}
setwd(dirname(getActiveDocumentContext()$path))

# Saved deseq dataframe from A_2.Rmd
load("df.RData")

# Read the csv files to data frames (From Assignment_2.ipynb)
data <- read_csv("../Data/data_event_sorted.csv") %>% tibble::column_to_rownames("index")
clinical <- read_csv("../Data/clinical_event_sorted.csv") %>% as.data.frame(clinical)

names(clinical)[names(clinical) == "Primary Cytogenetic Code"] <- "PCC"

# Generate necessary ddset to calculate variance
ddset <- DESeqDataSetFromMatrix(
  countData = data,
  colData = clinical,
  design = ~PCC
)
```


```{r}
# Normalizing data
dds_norm <- vst(ddset)

# Calculate the variance for each gene
variances <- apply(assay(dds_norm), 1, var)
des_variances <- sort(variances, decreasing=TRUE)

df_by_var_10 <- data.frame(assay(dds_norm)) %>% filter(des_variances > 10.301)
df_by_var_100 <- data.frame(assay(dds_norm)) %>% filter(des_variances > 5.5059)
df_by_var_1000 <- data.frame(assay(dds_norm)) %>% filter(des_variances > 2.4587)
df_by_var_5000 <- data.frame(assay(dds_norm)) %>% filter(des_variances > 0.8483)
df_by_var_10000 <- data.frame(assay(dds_norm)) %>% filter(des_variances > 0.4282)

```

# Save variance datasets

```{r}

setwd(dirname(getActiveDocumentContext()$path))

write.csv(df_by_var_10,"../Data/most_variable_10.csv")
write.csv(df_by_var_100,"../Data/most_variable_100.csv")
write.csv(df_by_var_1000,"../Data/most_variable_1000.csv")
write.csv(df_by_var_5000,"../Data/most_variable_5000.csv")
write.csv(df_by_var_10000,"../Data/most_variable_10000.csv")

```
